{% extends "wikiapp/navbar.html" %}

{% block page_content %}

{% if user.main_section %}

<div x-data="{hideSections: false}" class="flex flex-col">
    <div class="flex justify-evenly"
         x-data="{sectionSelected:false, currentArchiveId:0, currentSectionId:0, selectedclasses:'bg-blue-200'}" 
         @click.outside="currentSectionId = 0">

      <div class="flex flex-col border">
        <button class="basis-full" @click="hideSections = !hideSections">
          <i class="fa-solid" :class="hideSections ? 'fa-eye' : 'fa-eye-slash'"></i>
        </button>
      </div>

      <div class="basis-1/3 h-screen flex flex-col" :class="hideSections && 'hidden'"
            @clear-main-section.window="$refs.pivotsection.innerHTML = ''">
             <div class="flex justify-between w-full h-50 border border-rounded flex justify-around">
                {% if user.can_write_main_section %}
                <div class="flex basis-1/4">
                    <button class="basis-1/3 border border-black rounded-full" hx-trigger="click"
                        hx-get="{% url 'core:modal_section' user.main_section.id %}" hx-target="#pivot-section">
                        <i class="fa-solid fa-plus"></i>
                    </button>

                    <button class="basis-1/3 border border-black rounded-full"
                        hx-trigger="click" 
                        hx-get="{% url 'core:modal_archive' user.main_section.id %}" 
                        hx-target="#pivot-section">
                        <i class="fa-solid fa-file"></i>
                    </button>
                </div>
                {% endif %}
                {% if user.can_write_main_section %}
                <div class="flex flex-col rounded-lg basis-3/4 border border-black">
                {% else %}
                <div class="flex flex-col rounded-lg basis-full border border-black">
                {% endif %}
                    <div>
                        <input 
                            hx-get="{% url 'core:search' %}"
                            hx-trigger="keyup changed delay:1s"
                            hx-target="#list-files"
                            hx-swap="innerHTML"
                            placeholder="Search"
                            name="content" id="search" type="text"></input>
                    </div>
                    <div>
                        <label for="by-content">By content</label>
                        <input id="by-content" type="checkbox"></input>
                    </div>
                    <div id="list-files" @click.outside="$el.innerHTML=''">
                    </div>
                </div>
            </div>
            <div hx-trigger="load,new_section_parent_{{user.main_section.id}} from:body"
                hx-get="{% url 'core:children' user.main_section.id %}" id="tree-view" 
                class="border border-black rounded full-rounded" hx-swap="innerHTML">
            </div>
        </div>
        <div class="flex border border-black h-screen" id="writable-section" :class="hideSections ? 'basis-full' : 'basis-2/3'"></div>
    </div>
    <div x-ref="pivotsection" id="pivot-section">
    </div>
</div>
{% else %}
<div>
    User does not have a main section assigned
</div>
{% endif %}

{% endblock %}
